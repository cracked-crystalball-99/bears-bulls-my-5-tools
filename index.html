<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://www.googletagmanager.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: https://www.google-analytics.com; connect-src 'self' https://www.google-analytics.com https://analytics.google.com https://us-central1-gen-lang-client-0071896365.cloudfunctions.net; font-src 'self'; object-src 'none'; base-uri 'self'; form-action 'self';">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    
    <title>Free Stock Technical Analysis Tool with AI Assistant</title>
    <meta name="description" content="Free stock & crypto technical analysis tool with AI assistant. 15+ indicators: ADX, RSI, MACD, Bollinger Bands. Get instant VIP% buy/sell signals. Play chess while waiting for trades!" />
    <meta name="keywords" content="technical analysis, stock analysis, crypto analysis, trading signals, ADX, RSI, MACD, AI trading assistant, VIP percentage, buy sell signals, trading indicators, Bollinger Bands, CCI, free trading tool" />
    <meta name="author" content="Trading Analysis Master" />
    <link rel="canonical" href="https://cracked-crystalball-99.github.io/trading-analysis-master/" />
    <link rel="stylesheet" href="styles-testing.css?v=3.1">
    <link rel="stylesheet" href="ai-teacher-styles.css?v=1.0">
    <script src="custom-chart.js?v=3.1"></script>
    <script src="synthetic-data-generator.js?v=3.1"></script>
    <script src="ai-teacher.js?v=1.0"></script>
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìä</text></svg>">
    
  <!-- Google Analytics (Privacy-Compliant) - Trading Analysis Tool -->
  <script>
    // Trading Analytics - Isolated namespace to prevent cross-property tracking
    (function() {
      'use strict';
      
      // Initialize Google Analytics with standard dataLayer (isolation via cookie_prefix)
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      
      // Use repo-specific localStorage key to prevent conflicts
      const CONSENT_KEY = 'trading-analytics-consent';
      const GA_MEASUREMENT_ID = 'G-YQYWNB1WK2';
      const OTHER_MEASUREMENT_ID = 'DY4TBEES4D';  // Chess engine ID to block
      
      // ULTRA-AGGRESSIVE cookie cleanup - remove ALL non-trading cookies AND wrong measurement ID
      function clearAllForeignCookies() {
        const allCookies = document.cookie.split(';');
        const domains = ['.github.io', '.cracked-crystalball-99.github.io', 'cracked-crystalball-99.github.io', location.hostname, ''];
        const paths = ['/', '/chess-engine/', '/bears-bulls-my-5-tools/', '/trading-analysis-master/', ''];
        
        allCookies.forEach(cookie => {
          const cookieName = cookie.split('=')[0].trim();
          // Remove ANY cookie that:
          // 1. Contains the wrong measurement ID (DY4TBEES4D)
          // 2. Has chess_ prefix
          // 3. Is a GA cookie without trading_ prefix
          const isWrongMeasurementId = cookieName.includes(OTHER_MEASUREMENT_ID);
          const isChessCookie = cookieName.startsWith('chess_');
          const isUnprefixedGA = cookieName.startsWith('_ga') && !cookieName.startsWith('trading_');
          
          if (isWrongMeasurementId || isChessCookie || isUnprefixedGA) {
            domains.forEach(domain => {
              paths.forEach(path => {
                const domainStr = domain ? '; domain=' + domain : '';
                document.cookie = cookieName + '=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=' + path + domainStr;
              });
            });
          }
        });
      }
      
      // Run cleanup immediately
      clearAllForeignCookies();
      
      const analyticsConsent = localStorage.getItem(CONSENT_KEY);
      
      if (analyticsConsent === 'granted') {
        // DEBUG: Log environment details
        console.log('üîç GA Debug Info:');
        console.log('  Protocol:', location.protocol);
        console.log('  Hostname:', location.hostname);
        console.log('  Full URL:', location.href);
        console.log('  Consent:', analyticsConsent);
        
        const cookieDomain = location.hostname.includes('percentagesenvy') ? 'percentagesenvy.com' : 'cracked-crystalball-99.github.io';
        console.log('  Cookie Domain:', cookieDomain);
        
        // User has consented - load GA with privacy settings
        gtag('js', new Date());
        gtag('config', GA_MEASUREMENT_ID, {
          'anonymize_ip': true,
          'allow_google_signals': false,
          'allow_ad_personalization_signals': false,
          'cookie_domain': cookieDomain,
          'cookie_prefix': 'trading',
          'cookie_path': '/',
          'cookie_flags': 'SameSite=Lax;Secure',
          'send_page_view': true
        });
        
        console.log('  GA Config sent with prefix: trading');
        
        // Load GA script with STANDARD URL (no custom dataLayer parameter)
        const script = document.createElement('script');
        script.async = true;
        script.src = 'https://www.googletagmanager.com/gtag/js?id=' + GA_MEASUREMENT_ID;
        
        console.log('üì• Attempting to load GA script:', script.src);
        
        script.onerror = function(error) {
          console.error('‚ùå GA Script failed to load');
          console.error('   URL:', script.src);
          console.error('   This could be caused by:');
          console.error('     ‚Ä¢ Ad blocker (uBlock, AdBlock, Privacy Badger)');
          console.error('     ‚Ä¢ Browser privacy settings blocking analytics');
          console.error('     ‚Ä¢ Network/firewall blocking Google domains');
          console.error('     ‚Ä¢ Third-party cookie blocking');
          console.error('   Error:', error);
          
          // Check if we can reach Google at all
          fetch('https://www.google.com/favicon.ico', {mode: 'no-cors'})
            .then(() => console.log('   ‚úì Can reach google.com'))
            .catch(() => console.error('   ‚úó Cannot reach google.com - network issue'));
        };
        
        script.onload = function() {
          console.log('‚úÖ GA Script loaded successfully');
          
          // Burst cleanup to catch immediate cookie creation
          setTimeout(clearAllForeignCookies, 100);
          setTimeout(clearAllForeignCookies, 500);
          setTimeout(clearAllForeignCookies, 1000);
          
          // Check cookies after 2 seconds
          setTimeout(() => {
            const allCookies = document.cookie.split(';').map(c => c.trim());
            console.log('üç™ Current Cookies:');
            if (allCookies.length === 0 || (allCookies.length === 1 && allCookies[0] === '')) {
              console.warn('‚ö†Ô∏è NO COOKIES FOUND! This is the problem.');
            } else {
              allCookies.forEach(cookie => {
                const name = cookie.split('=')[0];
                if (name.includes('ga') || name.includes('trading')) {
                  console.log('  ‚úì', cookie.substring(0, 50) + '...');
                }
              });
            }
            
            // Check for specific expected cookies
            const hasTradingGa = document.cookie.includes('trading_ga');
            const hasGaMeasurement = document.cookie.includes('_ga_YQYWNB1WK2');
            console.log('  Expected cookies present:');
            console.log('    trading_ga:', hasTradingGa ? '‚úì' : '‚úó MISSING');
            console.log('    _ga_YQYWNB1WK2:', hasGaMeasurement ? '‚úì' : '‚úó MISSING');
          }, 2000);
        };
        
        document.head.appendChild(script);
        console.log('üìã Script element added to DOM');
        
        // AGGRESSIVE continuous cleanup every 500ms to catch GA cookie creation
        setInterval(clearAllForeignCookies, 500);
      } else {
        console.log('‚ÑπÔ∏è Analytics consent not granted - GA not loaded');
      }
    })();
  </script>
</head>
<body>
    <div class="main-container">
        <h1>Technical Analysis Tool</h1>

    <!-- Demo Mode Banner -->
    <div id="demoBanner" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: 2px solid #5a67d8; border-radius: 12px; padding: 20px; margin: 20px auto; text-align: center; color: white; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
        <div style="display: flex; align-items: center; justify-content: center; gap: 15px; flex-wrap: wrap;">
            <span style="font-size: 32px;">üéØ</span>
            <div style="text-align: left;">
                <h3 style="margin: 0 0 8px 0; color: #fff; font-size: 18px;">üìä Demo Mode: FANG + MAN Stocks</h3>
                <p style="margin: 0; font-size: 14px; line-height: 1.5; color: #e6e6ff;">
                    Try all 15 technical analysis tools with <strong>realistic synthetic data</strong> for 7 major tech stocks:<br>
                    <strong>FANG</strong> (Meta, Apple, Netflix, Google) + <strong>MAN</strong> (Microsoft, Amazon, NVIDIA)
                </p>
            </div>
        </div>
        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.3); font-size: 13px; color: #e6e6ff;">
            üí° <em>Educational data spanning 15 years ‚Ä¢ Perfect for learning technical analysis ‚Ä¢ No API costs</em>
        </div>
    </div>

    <!-- Cross-Promotion: Chess Engine -->
    <div class="section" id="chessPromotion" style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); border: 2px solid #3498db; border-radius: 12px; padding: 25px; margin: 20px auto; text-align: center;">
        <div style="color: white;">
            <h3 style="color: #3498db; margin-bottom: 15px;">üèÜ Challenge Your Strategic Mind!</h3>
            <p style="font-size: 16px; line-height: 1.6; margin-bottom: 20px; color: #ecf0f1;">
                Love analyzing patterns? Try our <strong>Chess Engine</strong> - the perfect complement to trading analysis!
                <br>Test your strategy skills while our AI learns your playing style.
            </p>
            <div style="display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; margin-top: 20px;">
                <a href="https://cracked-crystalball-99.github.io/chess-engine/" target="_blank" rel="noopener" 
                   style="background: #3498db; color: white; padding: 12px 24px; text-decoration: none; border-radius: 8px; font-weight: bold; transition: background 0.3s;">
                    ‚ôüÔ∏è Play Chess Engine
                </a>
                <span style="color: #bdc3c7; font-size: 14px; align-self: center;">
                    Free ‚Ä¢ No Registration Required
                </span>
            </div>
        </div>
    </div>

    <!-- Form to load CSV file -->
    <form id="csvForm">
        <label for="csvFile">Choose CSV file:</label>
        <input type="file" id="csvFile" accept=".csv" title="Choose a CSV file">
        <button type="submit">Load CSV</button>
    </form>

    <h1>Stock or Crypto Ticker Search</h1>
    <div class="ticker-search">
        <input type="text" id="ticker-input" placeholder="Type a ticker or entity name">
        <div id="suggestions"></div>
    </div>

    <!-- Date Picker -->
    <div class="date-picker">
        <div class="pre-select-buttons">
            <button class="pre-select" data-range="1D">1D</button>
            <button class="pre-select" data-range="5D">5D</button>
            <button class="pre-select" data-range="3M">3M</button>
            <button class="pre-select" data-range="6M">6M</button>
            <button class="pre-select" data-range="YTD">YTD</button>
            <button class="pre-select" data-range="1Y">1Y</button>
            <button class="pre-select" data-range="5Y">5Y</button>
            <button class="pre-select" data-range="MAX">MAX</button>
        </div>
        <label for="start-date">Start Date:</label>
        <input type="date" id="start-date">
        <label for="end-date">End Date:</label>
        <input type="date" id="end-date">
        <button id="fetch-data-button">Fetch Data</button>
    </div>

    <!-- Container for buttons and tables -->
    <div class="container">
        <!-- Table 1: Displaying CSV File Data -->
        <h2>Displaying My Yahoo CSV File Data (Table 1)</h2>
        <div class="scrollable">
            <table id="csvTable">
                <thead id="csvTableHead">
                    <tr>
                        <th>Date</th>
                        <th>Open</th>
                        <th>High</th>
                        <th>Low</th>
                        <th>Close</th>
                        <th>Adj Close</th>
                        <th>Volume</th>
                    </tr>
                </thead>
                <tbody id="csvTableBody"></tbody>
            </table>
        </div>
        
        <!-- Return to Last Tool Button -->
        <button class="return-to-tool-btn" onclick="returnToLastTool()" id="returnToToolBtn">‚Üì Return to Last Tool</button>

        <!-- ADX Values -->
        <div class="section">
            <div class="tooltip full-width-button">
                <button id="computeAdxValuesButton">Compute ADX Values</button>
                <span class="tooltiptext">
                    <strong>What is ADX?</strong> The Average Directional Index (ADX) measures the strength of a trend. <br><br>
                    <strong>What can it do for me as a trader?</strong> ADX helps identify strong trends, which can be useful for making trading decisions. <br><br>
                    <strong>How can it be calculated?</strong> ADX is calculated using the difference between the positive and negative directional indicators over a specified period.
                </span>
            </div>
            <h2>Average Directional Index (ADX) Values (Table 2)</h2>
            <div class="scrollable">
                <table id="adxTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>DI+</th>
                            <th>DI-</th>
                            <th>DX</th>
                            <th>ADX</th>
                        </tr>
                    </thead>
                    <tbody id="adxTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- ADXTR Values -->
        <div class="section">
            <button class="back-to-table1-btn" onclick="scrollToTable1()">‚Üë Back to Table 1</button>
            <div class="tooltip full-width-button has-chart">
                <button id="computeAdxtrValuesButton">Compute ADXTR Values</button>
                <span class="tooltiptext">
                    <strong>What is ADXTR?</strong> ADX Trading Signals (ADXTR) are generated based on ADX values. <br><br>
                    <strong>What can it do for me as a trader?</strong> ADXTR provides buy and sell signals based on the strength of the trend, helping traders make informed decisions. <br><br>
                    <strong>How can it be calculated?</strong> ADXTR signals are generated when ADX crosses certain thresholds, indicating changes in trend strength.
                </span>
            </div>
            <h2>Tool #1 Average Directional Index Trading Signals (ADXTR) (Table 3)</h2>
            <div class="scrollable">
                <table id="adxtrTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>ADXTR</th>
                        </tr>
                    </thead>
                    <tbody id="adxtrTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- Add other tables as needed -->

    </div>

        <!-- BB Values -->
        <div class="section">
            <button class="back-to-table1-btn" onclick="scrollToTable1()">‚Üë Back to Table 1</button>
            <div class="tooltip full-width-button">
                <button id="computeBbValuesButton" class="full-width-button">Compute BB Values</button>
                <span class="tooltiptext">
                    <strong>What is BB?</strong> Bollinger Bands (BB) measure volatility by plotting bands around a moving average. <br><br>
                    <strong>What can it do for me as a trader?</strong> BB helps identify overbought and oversold conditions, as well as potential price breakouts. <br><br>
                    <strong>How can it be calculated?</strong> BB is calculated using a moving average and standard deviations to plot upper and lower bands.
                </span>
            </div>
            <h2>Bollinger Bands (BB) Values (Table 4)</h2>
            <div class="scrollable">
                <table id="bbTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Lower Band</th>
                            <th>Mean</th>
                            <th>Upper Band</th>
                            <th>%B</th>
                        </tr>
                    </thead>
                    <tbody id="bbTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- BBTR Values -->
        <div class="section">
            <button class="back-to-table1-btn" onclick="scrollToTable1()">‚Üë Back to Table 1</button>
            <div class="tooltip full-width-button has-chart">
                <button id="computeBbtrValuesButton" class="full-width-button">Compute BBTR Values</button>
                <span class="tooltiptext">
                    <strong>What is BBTR?</strong> Bollinger Bands Trading Signals (BBTR) are generated based on BB values. <br><br>
                    <strong>What can it do for me as a trader?</strong> BBTR provides buy and sell signals based on the price's interaction with the Bollinger Bands. <br><br>
                    <strong>How can it be calculated?</strong> BBTR signals are generated when the price crosses the upper or lower Bollinger Bands.
                </span>
            </div>
            <h2>Tool #2 Bollinger Bands Trading Signals (BBTR) (Table 5)</h2>
            <div class="scrollable">
                <table id="bbtrTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>BBTR</th>
                        </tr>
                    </thead>
                    <tbody id="bbtrTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- CCI Values -->
        <div class="section">
            <button class="back-to-table1-btn" onclick="scrollToTable1()">‚Üë Back to Table 1</button>
            <div class="tooltip full-width-button">
                <button id="computeCciValuesButton" class="full-width-button">Compute CCI Values</button>
                <span class="tooltiptext">
                    <strong>What is CCI?</strong> The Commodity Channel Index (CCI) measures the deviation of the price from its average. <br><br>
                    <strong>What can it do for me as a trader?</strong> CCI helps identify overbought and oversold conditions, as well as potential trend reversals. <br><br>
                    <strong>How can it be calculated?</strong> CCI is calculated using the typical price, a moving average, and the mean deviation.
                </span>
            </div>
            <h2>Commodity Channel Index (CCI) Values (Table 6)</h2>
            <div class="scrollable">
                <table id="cciTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>CCI</th>
                        </tr>
                    </thead>
                    <tbody id="cciTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- CCITR Values -->
        <div class="section">
            <button class="back-to-table1-btn" onclick="scrollToTable1()">‚Üë Back to Table 1</button>
            <div class="tooltip full-width-button has-chart">
                <button id="computeCcitrValuesButton" class="full-width-button">Compute CCITR Values</button>
                <span class="tooltiptext">
                    <strong>What is CCITR?</strong> Commodity Channel Index Trading Signals (CCITR) are generated based on CCI values. <br><br>
                    <strong>What can it do for me as a trader?</strong> CCITR provides buy and sell signals based on the CCI's interaction with overbought and oversold levels. <br><br>
                    <strong>How can it be calculated?</strong> CCITR signals are generated when the CCI crosses certain thresholds, indicating overbought or oversold conditions.
                </span>
            </div>
            <h2>Tool #3 Commodity Channel Index Trading Signals (CCITR) (Table 7)</h2>
            <div class="scrollable">
                <table id="ccitrTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>CCITR</th>
                        </tr>
                    </thead>
                    <tbody id="ccitrTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- MACD Values -->
        <div class="section">
            <button class="back-to-table1-btn" onclick="scrollToTable1()">‚Üë Back to Table 1</button>
            <div class="tooltip full-width-button">
                <button id="computeMacdValuesButton" class="full-width-button">Compute MACD Values</button>
                <span class="tooltiptext">
                    <strong>What is MACD?</strong> The Moving Average Convergence Divergence (MACD) is a trend-following momentum indicator. <br><br>
                    <strong>What can it do for me as a trader?</strong> MACD helps identify changes in the strength, direction, momentum, and duration of a trend. <br><br>
                    <strong>How can it be calculated?</strong> MACD is calculated by subtracting the 26-period EMA from the 12-period EMA, with a 9-period EMA as the signal line.
                </span>
            </div>
            <h2>Moving Average Convergence Divergence (MACD) Values (Table 8)</h2>
            <div class="scrollable">
                <table id="macdTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>MACD</th>
                            <th>Signal Line</th>
                        </tr>
                    </thead>
                    <tbody id="macdTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- CMACD Values -->
        <div class="section">
            <button class="back-to-table1-btn" onclick="scrollToTable1()">‚Üë Back to Table 1</button>
            <div class="tooltip full-width-button has-chart">
                <button id="computeCmacdValuesButton" class="full-width-button">Compute CMACDTR Values</button>
                <span class="tooltiptext">
                    <strong>What is CMACD?</strong> The Centreline Moving Average Convergence Divergence (CMACD) is a variation of the MACD. <br><br>
                    <strong>What can it do for me as a trader?</strong> CMACD helps identify changes in the strength, direction, momentum, and duration of a trend. <br><br>
                    <strong>How can it be calculated?</strong> CMACD is calculated similarly to MACD but focuses on the centerline crossovers.
                </span>
            </div>
            <h2>Tool #4 Centreline Moving Average Convergence Divergence Trading Signals (CMACDTR) (Table 9)</h2>
            <div class="scrollable">
                <table id="cmacdTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>CMACD</th>
                        </tr>
                    </thead>
                    <tbody id="cmacdTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- SMACD Values -->
        <div class="section">
            <button class="back-to-table1-btn" onclick="scrollToTable1()">‚Üë Back to Table 1</button>
            <div class="tooltip full-width-button has-chart">
                <button id="computeSmacdValuesButton" class="full-width-button">Compute SMACDTR Values</button>
                <span class="tooltiptext">
                    <strong>What is SMACD?</strong> The Signal Moving Average Convergence Divergence (SMACD) is a variation of the MACD. <br><br>
                    <strong>What can it do for me as a trader?</strong> SMACD helps identify changes in the strength, direction, momentum, and duration of a trend. <br><br>
                    <strong>How can it be calculated?</strong> SMACD is calculated similarly to MACD but focuses on the signal line crossovers.
                </span>
            </div>
            <h2>Tool #5 Signal Moving Average Convergence Divergence Trading Signals (SMACDTR) (Table 10)</h2>
            <div class="scrollable">
                <table id="smacdTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>SMACD Signal</th>
                        </tr>
                    </thead>
                    <tbody id="smacdTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- ROC Values -->
        <div class="section">
            <button class="back-to-table1-btn" onclick="scrollToTable1()">‚Üë Back to Table 1</button>
            <div class="tooltip full-width-button">
                <button id="computeRocValuesButton" class="full-width-button">Compute ROC Values</button>
                <span class="tooltiptext">
                    <strong>What is ROC?</strong> The Rate of Change (ROC) measures the percentage change in price over a specified period. <br><br>
                    <strong>What can it do for me as a trader?</strong> ROC helps identify the speed and magnitude of price changes, which can be useful for making trading decisions. <br><br>
                    <strong>How can it be calculated?</strong> ROC is calculated by dividing the difference between the current price and the price n periods ago by the price n periods ago, then multiplying by 100.
                </span>
            </div>
            <h2>Rate of Change (ROC) Values (Table 11)</h2>
            <div class="scrollable">
                <table id="rocTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Close</th>
                        </tr>
                    </thead>
                    <tbody id="rocTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- ROCTR Values -->
        <div class="section">
            <button class="back-to-table1-btn" onclick="scrollToTable1()">‚Üë Back to Table 1</button>
            <div class="tooltip full-width-button has-chart">
                <button id="computeRoctrValuesButton" class="full-width-button">Compute ROCTR Values</button>
                <span class="tooltiptext">
                    <strong>What is ROCTR?</strong> Rate of Change Trading Signals (ROCTR) are generated based on ROC values. <br><br>
                    <strong>What can it do for me as a trader?</strong> ROCTR provides buy and sell signals based on the ROC's interaction with certain thresholds. <br><br>
                    <strong>How can it be calculated?</strong> ROCTR signals are generated when the ROC crosses certain thresholds, indicating changes in momentum.
                </span>
            </div>
            <h2>Tool #6 Rate of Change Trading Signals (ROCTR) (Table 12)</h2>
            <div class="scrollable">
                <table id="roctrTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>ROCTR</th>
                        </tr>
                    </thead>
                    <tbody id="roctrTableBody"></tbody>
                </table>
            </div>
        </div>

    <!-- New Tables (13-26) -->
        <!-- RSI Values -->
        <div class="section">
            <button class="back-to-table1-btn" onclick="scrollToTable1()">‚Üë Back to Table 1</button>
            <div class="tooltip full-width-button">
                <button id="computeRsiValuesButton" class="full-width-button">Compute RSI Values</button>
                <span class="tooltiptext">
                    <strong>What is RSI?</strong> The Relative Strength Index (RSI) measures the speed and change of price movements. <br><br>
                    <strong>What can it do for me as a trader?</strong> RSI helps identify overbought and oversold conditions, which can be useful for making trading decisions. <br><br>
                    <strong>How can it be calculated?</strong> RSI is calculated using the average gains and losses over a specified period, typically 14 days.
                </span>
            </div>
            <h2>Relative Strength Index (RSI) Values (Table 13)</h2>
            <div class="scrollable">
                <table id="rsiTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>RSI</th>
                        </tr>
                    </thead>
                    <tbody id="rsiTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- RSITR Values -->
        <div class="section">
            <button class="back-to-table1-btn" onclick="scrollToTable1()">‚Üë Back to Table 1</button>
            <div class="tooltip full-width-button has-chart">
                <button id="computeRsitrValuesButton" class="full-width-button">Compute RSITR Values</button>
                <span class="tooltiptext">
                    <strong>What is RSITR?</strong> Relative Strength Index Trading Signals (RSITR) are generated based on RSI values. <br><br>
                    <strong>What can it do for me as a trader?</strong> RSITR provides buy and sell signals based on the RSI's interaction with overbought and oversold levels. <br><br>
                    <strong>How can it be calculated?</strong> RSITR signals are generated when the RSI crosses certain thresholds, indicating overbought or oversold conditions.
                </span>
            </div>
            <h2>Tool #7 Relative Strength Index Trading Signals (RSITR) (Table 14)</h2>
            <div class="scrollable">
                <table id="rsitrTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>RSITR</th>
                        </tr>
                    </thead>
                    <tbody id="rsitrTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- SAR Values -->
        <div class="section">
            <button class="back-to-table1-btn" onclick="scrollToTable1()">‚Üë Back to Table 1</button>
            <div class="tooltip full-width-button">
                <button id="computeSarValuesButton" class="full-width-button">Compute SAR Values</button>
                <span class="tooltiptext">
                    <strong>What is SAR?</strong> The Parabolic Stop and Reverse (SAR) is a trend-following indicator that sets trailing stop-loss levels. <br><br>
                    <strong>What can it do for me as a trader?</strong> SAR helps identify potential reversals in the direction of the price movement, which can be useful for setting stop-loss levels and identifying entry and exit points. <br><br>
                    <strong>How can it be calculated?</strong> SAR is calculated using the most recent extreme price (EP) and an acceleration factor (AF).
                </span>
            </div>
            <h2>Parabolic Stop and Reverse (SAR) Values (Table 15)</h2>
            <div class="scrollable">
                <table id="sarTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>SAR</th>
                        </tr>
                    </thead>
                    <tbody id="sarTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- SARTR Values -->
        <div class="section">
            <button class="back-to-table1-btn" onclick="scrollToTable1()">‚Üë Back to Table 1</button>
            <div class="tooltip full-width-button has-chart">
                <button id="computeSartrValuesButton" class="full-width-button">Compute SARTR Values</button>
                <span class="tooltiptext">
                    <strong>What is SARTR?</strong> SAR Trading Signals (SARTR) are generated based on SAR values. <br><br>
                    <strong>What can it do for me as a trader?</strong> SARTR provides buy and sell signals based on the SAR's interaction with the price, helping traders make informed decisions. <br><br>
                    <strong>How can it be calculated?</strong> SARTR signals are generated when the price crosses the SAR, indicating potential reversals.
                </span>
            </div>
            <h2>Tool #8 Parabolic Stop and Reverse Trading Signals (SARTR) (Table 16)</h2>
            <div class="scrollable">
                <table id="sartrTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>SARTR</th>
                        </tr>
                    </thead>
                    <tbody id="sartrTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- SMI Values -->
        <div class="section">
            <button class="back-to-table1-btn" onclick="scrollToTable1()">‚Üë Back to Table 1</button>
            <div class="tooltip full-width-button">
                <button id="computeSmiValuesButton" class="full-width-button">Compute SMI Values</button>
                <span class="tooltiptext">
                    <strong>What is SMI?</strong> The Stochastic Momentum Index (SMI) measures the position of the current close relative to the midpoint of the recent high/low range. <br><br>
                    <strong>What can it do for me as a trader?</strong> SMI helps identify overbought and oversold conditions, as well as potential trend reversals. <br><br>
                    <strong>How can it be calculated?</strong> SMI is calculated using the difference between the current close and the midpoint of the recent high/low range, smoothed using exponential moving averages.
                </span>
            </div>
            <h2>Stochastic Momentum Index (SMI) Values (Table 17)</h2>
            <div class="scrollable">
                <table id="smiTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>SMI</th>
                        </tr>
                    </thead>
                    <tbody id="smiTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- SMITR Values -->
        <div class="section">
            <button class="back-to-table1-btn" onclick="scrollToTable1()">‚Üë Back to Table 1</button>
            <div class="tooltip full-width-button has-chart">
                <button id="computeSmitrValuesButton" class="full-width-button">Compute SMITR Values</button>
                <span class="tooltiptext">
                    <strong>What is SMITR?</strong> Stochastic Momentum Index Trading Signals (SMITR) are generated based on SMI values. <br><br>
                    <strong>What can it do for me as a trader?</strong> SMITR provides buy and sell signals based on the SMI's interaction with overbought and oversold levels. <br><br>
                    <strong>How can it be calculated?</strong> SMITR signals are generated when the SMI crosses certain thresholds, indicating overbought or oversold conditions.
                </span>
            </div>
            <h2>Tool #9 Stochastic Momentum Index Trading Signals (SMITR) (Table 18)</h2>
            <div class="scrollable">
                <table id="smitrTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>SMITR</th>
                        </tr>
                    </thead>
                    <tbody id="smitrTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- WPR Values -->
        <div class="section">
            <button class="back-to-table1-btn" onclick="scrollToTable1()">‚Üë Back to Table 1</button>
            <div class="tooltip full-width-button">
                <button id="computeWprValuesButton" class="full-width-button">Compute WPR Values</button>
                <span class="tooltiptext">
                    <strong>What is WPR?</strong> Williams %R (WPR) is a momentum indicator that measures overbought and oversold levels. <br><br>
                    <strong>What can it do for me as a trader?</strong> WPR helps identify overbought and oversold conditions, as well as potential trend reversals. <br><br>
                    <strong>How can it be calculated?</strong> WPR is calculated using the highest high, lowest low, and the most recent closing price over a specified period.
                </span>
            </div>
            <h2>Williams Percent Range (WPR) Values (Table 19)</h2>
            <div class="scrollable">
                <table id="wprTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>WPR</th>
                        </tr>
                    </thead>
                    <tbody id="wprTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- WPRTR Values -->
        <div class="section">
            <button class="back-to-table1-btn" onclick="scrollToTable1()">‚Üë Back to Table 1</button>
            <div class="tooltip full-width-button has-chart">
                <button id="computeWprtrValuesButton" class="full-width-button">Compute WPRTR Values</button>
                <span class="tooltiptext">
                    <strong>What is WPRTR?</strong> Williams %R Trading Signals (WPRTR) are generated based on WPR values. <br><br>
                    <strong>What can it do for me as a trader?</strong> WPRTR provides buy and sell signals based on the WPR's interaction with overbought and oversold levels. <br><br>
                    <strong>How can it be calculated?</strong> WPRTR signals are generated when the WPR crosses certain thresholds, indicating overbought or oversold conditions.
                </span>
            </div>
            <h2>Tool #10 Williams Percent Range Trading Signals (WPRTR) (Table 20)</h2>
            <div class="scrollable">
                <table id="wprtrTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>WPRTR</th>
                        </tr>
                    </thead>
                    <tbody id="wprtrTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- SMA5 Values -->
        <div class="section">
            <button class="back-to-table1-btn" onclick="scrollToTable1()">‚Üë Back to Table 1</button>
            <div class="tooltip full-width-button">
                <button id="computeSma5ValuesButton" class="full-width-button">Compute SMA5 Values</button>
                <span class="tooltiptext">
                    <strong>What is SMA5?</strong> The Simple Moving Average (SMA) for 5 observations calculates the average of the closing prices for the last 5 periods. <br><br>
                    <strong>What can it do for me as a trader?</strong> SMA5 helps identify the direction of the trend and can act as a support or resistance level. <br><br>
                    <strong>How can it be calculated?</strong> SMA5 is calculated by adding the closing prices of the last 5 periods and dividing by 5.
                </span>
            </div>
            <h2>5-Period Simple Moving Average (SMA5) Values (Table 21)</h2>
            <div class="scrollable">
                <table id="sma5Table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>SMA5</th>
                        </tr>
                    </thead>
                    <tbody id="sma5TableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- Table 22: CCISMATR Values -->
        <div class="section">
            <button class="back-to-table1-btn" onclick="scrollToTable1()">‚Üë Back to Table 1</button>
            <div class="tooltip full-width-button has-chart">
                <button id="computeCcismatrValuesButton" class="full-width-button">Compute CCISMATR Values</button>
                <span class="tooltiptext">
                    <strong>What is CCISMATR?</strong> Commodity Channel Index Simple Moving Average Trading Signals (CCISMATR) are generated based on CCI and SMA values. <br><br>
                    <strong>What can it do for me as a trader?</strong> CCISMATR provides buy and sell signals based on the interaction of CCI and SMA, helping traders make informed decisions. <br><br>
                    <strong>How can it be calculated?</strong> CCISMATR signals are generated when the CCI crosses above or below the SMA, indicating potential buy or sell opportunities.
                </span>
            </div>
            <h2>Tool #11 Commodity Channel Index Simple Moving Average Trading Signals (CCISMATR) (Table 22)</h2>
            <div class="scrollable">
                <table id="ccismatrTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Signal</th>
                        </tr>
                    </thead>
                    <tbody id="ccismatrTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- Table 23: ROCSMATR Values -->
        <div class="section">
            <button class="back-to-table1-btn" onclick="scrollToTable1()">‚Üë Back to Table 1</button>
            <div class="tooltip full-width-button has-chart">
                <button id="computeRocsmatrValuesButton" class="full-width-button">Compute ROCSMATR Values</button>
                <span class="tooltiptext">
                    <strong>What is ROCSMATR?</strong> Rate of Change Simple Moving Average Trading Signals (ROCSMATR) are generated based on ROC and SMA values. <br><br>
                    <strong>What can it do for me as a trader?</strong> ROCSMATR provides buy and sell signals based on the interaction of ROC and SMA, helping traders make informed decisions. <br><br>
                    <strong>How can it be calculated?</strong> ROCSMATR signals are generated when the ROC crosses above or below the SMA, indicating potential buy or sell opportunities.
                </span>
            </div>
            <h2>Tool #12 Rate of Change Simple Moving Average Trading Signals (ROCSMATR) (Table 23)</h2>
            <div class="scrollable">
                <table id="rocsmatrTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Signal</th>
                        </tr>
                    </thead>
                    <tbody id="rocsmatrTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- Table 24: RSISMATR Values -->
        <div class="section">
            <button class="back-to-table1-btn" onclick="scrollToTable1()">‚Üë Back to Table 1</button>
            <div class="tooltip full-width-button has-chart">
                <button id="computeRsismatrValuesButton" class="full-width-button">Compute RSISMATR Values</button>
                <span class="tooltiptext">
                    <strong>What is RSISMATR?</strong> Relative Strength Index Simple Moving Average Trading Signals (RSISMATR) are generated based on RSI and SMA values. <br><br>
                    <strong>What can it do for me as a trader?</strong> RSISMATR provides buy and sell signals based on the interaction of RSI and SMA, helping traders make informed decisions. <br><br>
                    <strong>How can it be calculated?</strong> RSISMATR signals are generated when the RSI crosses above or below the SMA, indicating potential buy or sell opportunities.
                </span>
            </div>
            <h2>Tool #13 Relative Strength Index Simple Moving Average Trading Signals (RSISMATR) (Table 24)</h2>
            <div class="scrollable">
                <table id="rsismatrTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Signal</th>
                        </tr>
                    </thead>
                    <tbody id="rsismatrTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- Table 25: SMISMATR Values -->
        <div class="section">
            <button class="back-to-table1-btn" onclick="scrollToTable1()">‚Üë Back to Table 1</button>
            <div class="tooltip full-width-button has-chart">
                <button id="computeSmismatrValuesButton" class="full-width-button">Compute SMISMATR Values</button>
                <span class="tooltiptext">
                    <strong>What is SMISMATR?</strong> Stochastic Momentum Index Simple Moving Average Trading Signals (SMISMATR) are generated based on SMI and SMA values. <br><br>
                    <strong>What can it do for me as a trader?</strong> SMISMATR provides buy and sell signals based on the interaction of SMI and SMA, helping traders make informed decisions. <br><br>
                    <strong>How can it be calculated?</strong> SMISMATR signals are generated when the SMI crosses above or below the SMA, indicating potential buy or sell opportunities.
                </span>
            </div>
            <h2>Tool #14 Stochastic Momentum Index Simple Moving Average Trading Signals (SMISMATR) (Table 25)</h2>
            <div class="scrollable">
                <table id="smismatrTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>SMISMATR</th>
                        </tr>
                    </thead>
                    <tbody id="smismatrTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- Table 26: WPRSMATR Values -->
        <div class ="section">
            <button class="back-to-table1-btn" onclick="scrollToTable1()">‚Üë Back to Table 1</button>
            <div class="tooltip full-width-button has-chart">
                <button id="computeWprsmatrValuesButton" class="full-width-button">Compute WPRSMATR Values</button>
                <span class="tooltiptext">
                    <strong>What is WPRSMATR?</strong> Williams Percent Range Simple Moving Average Trading Signals (WPRSMATR) are generated based on WPR and SMA values. <br><br>
                    <strong>What can it do for me as a trader?</strong> WPRSMATR provides buy and sell signals based on the interaction of WPR and SMA, helping traders make informed decisions. <br><br>
                    <strong>How can it be calculated?</strong> WPRSMATR signals are generated when the WPR crosses above or below the SMA, indicating potential buy or sell opportunities.
                </span>
            </div>
            <h2>Tool #15 Williams Percent Range Simple Moving Average Trading Signals (WPRSMATR) (Table 26)</h2>
            <div class="scrollable">
                <table id="wprsmatrTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>WPRSMATR</th>
                        </tr>
                    </thead>
                    <tbody id="wprsmatrTableBody"></tbody>
                </table>
            </div>
        </div>

    
    <!-- Votes Innovative Percentages (VIP %) -->
    <h2>Votes Innovative Percentages (VIP %)</h2>
    <div class="scrollable">
        <table id="votesTable">
            <thead>
                <tr>
                    <th>Technical Analysis Tool (TAT)</th>
                    <th>Buy?</th>
                    <th>Sell?</th>
                    <th>Tool Voice Count (TVC)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Tool #1 Average Directional Index Trading Signals (ADXTR)</td>
                    <td id="b2"></td> <!-- Buy votes -->
                    <td id="c2"></td> <!-- Sell votes -->
                    <td id="d2"></td> <!-- Total voice count & Conditional formatting cell -->
                </tr>
                <tr><td>Tool #2 Bollinger Bands Trading Signals (BBTR)</td><td id="b3"></td><td id="c3"></td><td id="d3"></td></tr>
                <tr><td>Tool #3 Commodity Channel Index Trading Signals (CCITR)</td><td id="b4"></td><td id="c4"></td><td id="d4"></td></tr>
                <tr><td>Tool #4 Centreline Moving Average Convergence Divergence (MACD) Trading Signals (CMACDTR)</td><td id="b5"></td><td id="c5"></td><td id="d5"></td></tr>
                <tr><td>Tool #5 Signal Moving Average Convergence Divergence (MACD) Trading Signals (SMACDTR)</td><td id="b6"></td><td id="c6"></td><td id="d6"></td></tr>
                <tr><td>Tool #6 Rate of Change Trading Signals (ROCTR)</td><td id="b7"></td><td id="c7"></td><td id="d7"></td></tr>
                <tr><td>Tool #7 Relative Strength Index Trading Signals (RSITR)</td><td id="b8"></td><td id="c8"></td><td id="d8"></td></tr>
                <tr><td>Tool #8 Stop and Reverse Trading Signals (SARTR)</td><td id="b9"></td><td id="c9"></td><td id="d9"></td></tr>
                <tr><td>Tool #9 Stochastic Momentum Index Trading Signals (SMITR)</td><td id="b10"></td><td id="c10"></td><td id="d10"></td></tr>
                <tr><td>Tool #10 Williams % R Trading Signals (WPRTR)</td><td id="b11"></td><td id="c11"></td><td id="d11"></td></tr>
                <tr><td>Tool #11 Commodity Channel Index Simple Moving Average Trading Signals (CCISMATR)</td><td id="b12"></td><td id="c12"></td><td id="d12"></td></tr>
                <tr><td>Tool #12 Rate of Change Simple Moving Average Trading Signals (ROCSMATR)</td><td id="b13"></td><td id="c13"></td><td id="d13"></td></tr>
                <tr><td>Tool #13 Relative Strength Index Simple Moving Average Trading Signals (RSISMATR)</td><td id="b14"></td><td id="c14"></td><td id="d14"></td></tr>
                <tr><td>Tool #14 Stochastic Momentum Index Simple Moving Average Trading Signals (SMISMATR)</td><td id="b15"></td><td id="c15"></td><td id="d15"></td></tr>
                <tr><td>Tool #15 Williams % R Simple Moving Average Trading Signals (WPRSMATR)</td><td id="b16"></td><td id="c16"></td><td id="d16"></td></tr>
                <!-- Tool Group Voice Count (TGVC) row -->
                <tr><td>Tool Group Voice Count (TGVC)</td><td id="b17"></td><td id="c17"></td></tr>
                <!-- VIP % row -->
                <tr><td>VIP %</td><td id="b18" class="green-cell"></td><td id="c18" class="red-cell"></td></tr>
            </tbody>
        </table>
    </div>

    <!-- Chart Section for All Tools -->
    <div class="section" id="chartSection">
        <div class="chart-header">
            <h2>Tool #s 1-15 Votes Chart</h2>
            <button class="back-to-tools-btn" onclick="scrollBackToSource()" id="backToSourceBtn">‚Üë Back to Tool</button>
        </div>
        <canvas id="allToolsVotesChart" width="800" height="400"></canvas>
    </div>
   
    <script src="main.js?v=3.2"></script>
    <script src="fetch-gcf.js?v=3.2"></script>

    <script>
        // Set the minimum date for the date picker inputs
        document.addEventListener('DOMContentLoaded', function() {
            const minDate = '2015-01-01';
            document.getElementById('start-date').setAttribute('min', minDate);
            document.getElementById('end-date').setAttribute('min', minDate);
        });

        // Handle pre-select buttons for date ranges
        document.querySelectorAll('.pre-select').forEach(button => {
            button.addEventListener('click', function() {
                const range = this.getAttribute('data-range');
                const endDate = new Date();
                let startDate;

                switch (range) {
                    case '1D':
                        startDate = new Date(endDate);
                        startDate.setDate(endDate.getDate() - 1);
                        break;
                    case '5D':
                        startDate = new Date(endDate);
                        startDate.setDate(endDate.getDate() - 5);
                        break;
                    case '3M':
                        startDate = new Date(endDate);
                        startDate.setMonth(endDate.getMonth() - 3);
                        break;
                    case '6M':
                        startDate = new Date(endDate);
                        startDate.setMonth(endDate.getMonth() - 6);
                        break;
                    case 'YTD':
                        startDate = new Date(endDate.getFullYear(), 0, 1);
                        break;
                    case '1Y':
                        startDate = new Date(endDate);
                        startDate.setFullYear(endDate.getFullYear() - 1);
                        break;
                    case '5Y':
                        startDate = new Date(endDate);
                        startDate.setFullYear(endDate.getFullYear() - 5);
                        break;
                    case 'MAX':
                        startDate = new Date('2015-01-01');
                        break;
                }

                document.getElementById('start-date').value = startDate.toISOString().split('T')[0];
                document.getElementById('end-date').value = endDate.toISOString().split('T')[0];
            });
        });
    </script>

    <!-- Privacy Settings Section - Collapsible -->
    <div id="privacyPanel" style="position: fixed; top: 10px; left: 10px; z-index: 10001; background: rgba(255,255,255,0.95); padding: 10px; border-radius: 8px; border: 1px solid #ddd; font-size: 0.8rem; box-shadow: 0 2px 10px rgba(0,0,0,0.1); transition: all 0.3s ease; cursor: pointer;">
      <!-- Collapsed Badge View -->
      <div id="privacyBadge" style="display: none;">
        <div style="font-size: 1.2rem; line-height: 1;">üîí</div>
        <div id="privacyBadgeStatus" style="font-size: 0.65rem; margin-top: 2px; font-weight: bold;"></div>
      </div>
      
      <!-- Expanded Full Controls View -->
      <div id="privacyControls">
        <div style="font-weight: bold; margin-bottom: 5px; color: #333;">
          üîí Privacy Settings
        </div>
        <div id="privacyStatus" style="margin-bottom: 8px; color: #666;">
          Checking privacy preferences...
        </div>
        <div style="display: flex; gap: 5px; flex-wrap: wrap;">
          <button onclick="enableAnalytics(); event.stopPropagation();" style="background: #28a745; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 0.7rem; cursor: pointer;">
            ‚úÖ Enable
          </button>
          <button onclick="disableAnalytics(); event.stopPropagation();" style="background: #dc3545; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 0.7rem; cursor: pointer;">
            ‚ùå Disable
          </button>
          <button onclick="showPrivacyInfo(); event.stopPropagation();" style="background: #007bff; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 0.7rem; cursor: pointer;">
            ‚ÑπÔ∏è Info
          </button>
        </div>
      </div>
    </div>

  <script>
    // Trading Analytics Privacy Management (Isolated Namespace)
    (function() {
      'use strict';
      
      const CONSENT_KEY = 'trading-analytics-consent';
      const GA_MEASUREMENT_ID = 'G-YQYWNB1WK2';
      
      // Cookie clearing utility
      function clearAnalyticsCookies() {
        const cookiesToClear = [
          '_ga',
          '_ga_' + GA_MEASUREMENT_ID.replace('G-', ''),
          '_gid',
          '_gat'
        ];
        
        cookiesToClear.forEach(cookieName => {
          // Clear with various domain configurations
          document.cookie = cookieName + '=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
          document.cookie = cookieName + '=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=' + location.hostname + ';';
          if (location.hostname.includes('.')) {
            const baseDomain = '.' + location.hostname.split('.').slice(-2).join('.');
            document.cookie = cookieName + '=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=' + baseDomain + ';';
          }
        });
      }
      
      // Global functions for UI buttons (exposed to window)
      window.enableAnalytics = function() {
        try {
          localStorage.setItem(CONSENT_KEY, 'granted');
          updatePrivacyStatus();
          location.reload();
        } catch (e) {
          console.error('Failed to enable analytics:', e);
        }
      };
      
      window.disableAnalytics = function() {
        try {
          localStorage.setItem(CONSENT_KEY, 'denied');
          clearAnalyticsCookies();
          updatePrivacyStatus();
          const banner = document.getElementById('privacyBanner');
          if (banner) banner.classList.remove('show');
        } catch (e) {
          console.error('Failed to disable analytics:', e);
        }
      };
      
      window.acceptAnalytics = function() {
        try {
          localStorage.setItem(CONSENT_KEY, 'granted');
          location.reload();
        } catch (e) {
          console.error('Failed to accept analytics:', e);
        }
      };
      
      window.declineAnalytics = function() {
        try {
          localStorage.setItem(CONSENT_KEY, 'denied');
          clearAnalyticsCookies();
          const banner = document.getElementById('privacyBanner');
          if (banner) banner.classList.remove('show');
        } catch (e) {
          console.error('Failed to decline analytics:', e);
        }
      };
      
      window.showPrivacyInfo = function() {
        const consent = localStorage.getItem(CONSENT_KEY);
        alert('Privacy Information:\n\n' +
              '‚Ä¢ We use Google Analytics to understand how the trading analysis tool is used\n' +
              '‚Ä¢ All data is anonymized and aggregated\n' +
              '‚Ä¢ No personal information is collected or stored\n' +
              '‚Ä¢ You can enable/disable analytics anytime\n' +
              '‚Ä¢ The tool works fully without analytics\n' +
              '‚Ä¢ This tool uses isolated tracking (trading-analytics-consent)\n\n' +
              'Current status: ' + (consent || 'Not set') + '\n\n' +
              'Measurement ID: ' + GA_MEASUREMENT_ID);
      };
      
      window.resetPrivacySettings = function() {
        localStorage.removeItem(CONSENT_KEY);
        clearAnalyticsCookies();
        location.reload();
      };
      
      function updatePrivacyStatus() {
        const consent = localStorage.getItem(CONSENT_KEY);
        const statusEl = document.getElementById('privacyStatus');
        const badgeStatusEl = document.getElementById('privacyBadgeStatus');
        
        if (!statusEl) return;
        
        if (consent === 'granted') {
          statusEl.textContent = '‚úÖ Analytics enabled - helping improve the tool';
          statusEl.style.color = '#28a745';
          if (badgeStatusEl) {
            badgeStatusEl.textContent = 'Enabled';
            badgeStatusEl.style.color = '#28a745';
          }
        } else if (consent === 'denied') {
          statusEl.textContent = '‚ùå Analytics disabled - your privacy is protected';
          statusEl.style.color = '#dc3545';
          if (badgeStatusEl) {
            badgeStatusEl.textContent = 'Disabled';
            badgeStatusEl.style.color = '#dc3545';
          }
        } else {
          statusEl.textContent = '‚ö™ No preference set - click to choose';
          statusEl.style.color = '#6c757d';
          if (badgeStatusEl) {
            badgeStatusEl.textContent = 'Not Set';
            badgeStatusEl.style.color = '#6c757d';
          }
        }
      }
      
      // Toggle privacy panel between collapsed and expanded
      window.togglePrivacyPanel = function() {
        const panel = document.getElementById('privacyPanel');
        const badge = document.getElementById('privacyBadge');
        const controls = document.getElementById('privacyControls');
        
        if (!panel || !badge || !controls) return;
        
        const isCollapsed = badge.style.display !== 'none';
        
        if (isCollapsed) {
          // Expand
          badge.style.display = 'none';
          controls.style.display = 'block';
          panel.style.padding = '10px';
          panel.style.minWidth = 'auto';
        } else {
          // Collapse
          badge.style.display = 'block';
          controls.style.display = 'none';
          panel.style.padding = '8px';
          panel.style.minWidth = '60px';
        }
      };
      
      // Collapse panel if user has already made a choice
      function autoCollapseIfChosen() {
        const consent = localStorage.getItem(CONSENT_KEY);
        const panel = document.getElementById('privacyPanel');
        const badge = document.getElementById('privacyBadge');
        const controls = document.getElementById('privacyControls');
        
        if (!panel || !badge || !controls) return;
        
        // If user has made a choice, start collapsed
        if (consent === 'granted' || consent === 'denied') {
          badge.style.display = 'block';
          controls.style.display = 'none';
          panel.style.padding = '8px';
          panel.style.minWidth = '60px';
        } else {
          // If no choice yet, keep expanded
          badge.style.display = 'none';
          controls.style.display = 'block';
        }
      }
      
      // Initialize privacy system
      setTimeout(function() {
        const analyticsConsent = localStorage.getItem(CONSENT_KEY);
        
        if (!analyticsConsent) {
          setTimeout(() => {
            const privacyBanner = document.getElementById('privacyBanner');
            if (privacyBanner) {
              privacyBanner.classList.add('show');
            }
          }, 2000);
        }
        
        updatePrivacyStatus();
        autoCollapseIfChosen();
        
        // Add click handler to toggle panel
        const panel = document.getElementById('privacyPanel');
        if (panel) {
          panel.addEventListener('click', function(e) {
            // Don't toggle if clicking a button
            if (e.target.tagName !== 'BUTTON') {
              togglePrivacyPanel();
            }
          });
        }
      }, 1500);
      
    })();
    
    // Mobile-friendly tooltip system with decoupled lightbulb control
    document.addEventListener('DOMContentLoaded', function() {
      const tooltips = document.querySelectorAll('.tooltip');
      
      tooltips.forEach(tooltip => {
        // Handle clicks on the tooltip container
        tooltip.addEventListener('click', function(e) {
          // Check if we're on a touch device
          if ('ontouchstart' in window || navigator.maxTouchPoints > 0) {
            const rect = this.getBoundingClientRect();
            const clickX = e.clientX - rect.left;
            const clickY = e.clientY - rect.top;
            
            // Expanded click area for the lightbulb with better mobile detection
            const isLightbulbClick = (clickX > rect.width - 120 && clickY < 30 && clickY > -35) ||
                                   (e.target.textContent && e.target.textContent.includes('üí°')) ||
                                   (e.target.innerHTML && e.target.innerHTML.includes('üí°'));
            
            if (isLightbulbClick) {
              e.preventDefault();
              e.stopPropagation();
              
              // Toggle tooltip visibility
              const wasActive = this.classList.contains('active');
              
              // Remove active class from all other tooltips
              tooltips.forEach(t => {
                if (t !== this) t.classList.remove('active');
              });
              
              // Toggle this tooltip
              if (wasActive) {
                this.classList.remove('active');
              } else {
                this.classList.add('active');
              }
              
              // Force a reflow to ensure the change takes effect
              this.offsetHeight;
            }
            // If not lightbulb click, let the button handle it normally
          }
        });
        
        // Handle button clicks normally (no tooltip interference)
        const button = tooltip.querySelector('button');
        if (button) {
          button.addEventListener('click', function(e) {
            // On touch devices, don't interfere with button functionality
            if ('ontouchstart' in window || navigator.maxTouchPoints > 0) {
              // Let the button work normally without affecting tooltips
              return;
            }
          });
        }
      });
      
      // Handle chart navigation button clicks for 'tr' buttons
      tooltips.forEach(tooltip => {
        if (tooltip.classList.contains('has-chart')) {
          tooltip.addEventListener('click', function(e) {
            if ('ontouchstart' in window || navigator.maxTouchPoints > 0) {
              const rect = this.getBoundingClientRect();
              const clickX = e.clientX - rect.left;
              const clickY = e.clientY - rect.top;
              
              // Check if click is on the chart navigation button (left side)
              const isChartNavClick = clickX < 110 && clickY < 15 && clickY > -25;
              
              if (isChartNavClick) {
                e.preventDefault();
                e.stopPropagation();
                
                // Track source button
                const button = this.querySelector('button');
                if (button && button.id) {
                  sourceButtonId = button.id;
                  const backBtn = document.getElementById('backToSourceBtn');
                  if (backBtn) {
                    const buttonText = button.textContent.replace('Compute ', '').replace(' Values', '');
                    backBtn.textContent = `‚Üë Back to ${buttonText}`;
                  }
                }
                
                // Scroll to chart section
                const chartSection = document.getElementById('chartSection');
                if (chartSection) {
                  chartSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
              }
            }
          });
        }
      });
      
      // Close tooltips when clicking outside or on close instruction
      document.addEventListener('click', function(e) {
        const tooltip = e.target.closest('.tooltip');
        
        // If clicking outside any tooltip, close all
        if (!tooltip) {
          tooltips.forEach(t => t.classList.remove('active'));
          return;
        }
        
        // If clicking on active tooltip, check if it's the close instruction area
        if (tooltip && tooltip.classList.contains('active')) {
          const tooltiptext = tooltip.querySelector('.tooltiptext');
          if (tooltiptext) {
            // Check if click is on the tooltip content
            if (tooltiptext.contains(e.target)) {
              const rect = tooltiptext.getBoundingClientRect();
              const clickY = e.clientY - rect.top;
              
              // If click is in the top 60px (close instruction area), close tooltip
              if (clickY < 60) {
                e.preventDefault();
                e.stopPropagation();
                tooltip.classList.remove('active');
                return;
              }
            } else {
              // Clicking outside tooltip content, close it
              tooltip.classList.remove('active');
            }
          }
        }
      });
    });
    
    // Track which button sent user to chart
    let sourceButtonId = null;
    
    // Back to source button navigation function
    function scrollBackToSource() {
      if (sourceButtonId) {
        const sourceButton = document.getElementById(sourceButtonId);
        if (sourceButton) {
          sourceButton.scrollIntoView({ behavior: 'smooth', block: 'center' });
          return;
        }
      }
      // Fallback to first section if no source tracked
      const toolsSection = document.querySelector('.section');
      if (toolsSection) {
        toolsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    }
    
    // Track last tool location
    let lastToolButtonId = null;
    
    // Back to Table 1 navigation function - now tracks where user came from
    function scrollToTable1() {
      // Find which section the user is currently in
      const sections = document.querySelectorAll('.section');
      sections.forEach((section, index) => {
        if (index > 0) { // Skip first section (Table 1)
          const rect = section.getBoundingClientRect();
          if (rect.top <= window.innerHeight / 2 && rect.bottom >= window.innerHeight / 2) {
            const button = section.querySelector('button[id*="compute"]');
            if (button && button.id) {
              lastToolButtonId = button.id;
              const returnBtn = document.getElementById('returnToToolBtn');
              if (returnBtn) {
                const toolName = button.textContent.replace('Compute ', '').replace(' Values', '');
                returnBtn.textContent = `‚Üì Return to ${toolName}`;
                returnBtn.classList.add('show');
              }
            }
          }
        }
      });
      
      const table1Section = document.querySelector('.section');
      if (table1Section) {
        table1Section.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    }
    
    // Return to last tool function
    function returnToLastTool() {
      if (lastToolButtonId) {
        const lastButton = document.getElementById(lastToolButtonId);
        if (lastButton) {
          lastButton.scrollIntoView({ behavior: 'smooth', block: 'center' });
          // Hide the return button after use
          const returnBtn = document.getElementById('returnToToolBtn');
          if (returnBtn) {
            returnBtn.classList.remove('show');
          }
        }
      }
    }

    // Privacy functions are now handled in the isolated IIFE above
  </script>

  <!-- Privacy Consent Banner -->
  <div id="privacyBanner" class="privacy-banner">
    <div class="privacy-banner-content">
      <div class="privacy-banner-text">
        üç™ <strong>Privacy Notice:</strong> This trading analysis tool uses analytics to improve your experience. We anonymize all data and don't track personal information.
      </div>
      <div class="privacy-banner-buttons">
        <button class="privacy-btn privacy-btn-accept" onclick="acceptAnalytics()">
          ‚úÖ Accept
        </button>
        <button class="privacy-btn privacy-btn-decline" onclick="declineAnalytics()">
          ‚ùå Decline
        </button>
        <button class="privacy-btn privacy-btn-info" onclick="showPrivacyInfo()">
          ‚ÑπÔ∏è Info
        </button>
      </div>
    </div>
  </div>

    </div> <!-- Close main-container -->
    
    <!-- Loading Indicator -->
    <div id="loadingIndicator" class="loading-indicator">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <span class="loading-text">Loading...</span>
        </div>
    </div>
    
    <!-- AI Trading Teacher Integration -->
    <script src="ai-teacher-ui.js?v=1.0"></script>
</body>

</html>